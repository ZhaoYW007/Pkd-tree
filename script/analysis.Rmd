
```{r setup, include=FALSE}

library(dplyr)
library(tidyr)
library(ggplot2)
library(xtable)
library(gsubfn)
library(fmtr)
library(stringr)
library(common)
library(proto)
library(patchwork)

library(ggthemes)
theme_set(theme_light())
'%!in%' <- function(x,y)!('%in%'(x,y))
setwd("/home/zmen002/KDtree/")

# options(scipen = 999)
# options(digits = 10, nsmall = 3)
```

with num 
```{R}
# setwd("/home/zmen002/KDtree")
kd<-read.csv("script/my_kd.csv",header=TRUE)
cgal<-read.csv("script/cgal.csv",header=TRUE)
t<-kd %>% bind_rows(cgal)
t
```

header[] = solver,benchType,nodes,dims,file,buildTime,queryTime,wrapSize
 
```{R}
queryByDim<-t %>% 
    group_by(solver,benchType,dims) %>%
    summarise(avg=mean(queryTime/nodes),.groups="drop") %>% 
    filter(benchType=='craft_var_dim')  %>%
    select(solver, dims, avg)

buildByDim<-t %>% 
    group_by(solver,benchType,dims) %>%
    summarise(avg=mean(buildTime),.groups="drop") %>% 
    filter(benchType=='craft_var_dim')  %>%
    select(solver, dims, avg)
```

```{R}
queryByNodes <- t %>%
    group_by(solver, benchType, nodes) %>%
    summarise(avg=mean(queryTime/nodes),.groups="drop")  %>% 
    filter(benchType=='craft_var_node')  %>%
    select(solver, nodes, avg)

buildByNodes<-t %>% 
    group_by(solver,benchType,nodes) %>%
    summarise(avg=mean(buildTime),.groups="drop") %>% 
    filter(benchType=='craft_var_node')  %>%
    select(solver, nodes, avg)
```

plot the dim graph
```{R}
gBuildDim<-ggplot(buildByDim, aes(x = dims, y = avg, color = solver, shape = solver))+
  geom_point(size=3) +
  geom_line() + 
  theme_gray() + 
  labs(y="Ave build time") +
  scale_x_continuous(name="dims",breaks=seq(2,16,by=2),limits =c(2,16) )

gQueryDim<-ggplot(queryByDim, aes(x = dims, y = avg, color = solver, shape = solver))+
  geom_point(size=3) +
  geom_line() + 
  theme_gray() + 
  labs(y="Ave query time")+
  scale_x_continuous(name="dims",breaks=seq(2,16,by=2),limits =c(2,16) )

```

plot the node graph
```{R}
gBuildNode<-ggplot(buildByNodes, aes(x = nodes, y = avg, color = solver, shape = solver))+
  geom_point(size=3) +
  geom_line() + 
  theme_gray() +
  labs(y="Ave build time")

gQueryNode<-ggplot(queryByNodes, aes(x = nodes, y = avg, color = solver, shape = solver))+
  geom_point(size = 3) +
  geom_line() + 
  theme_gray() +
  labs(y="Ave query time")

```

summarize the plot info: https://ggplot2-book.org/arranging-plots.html
c(a,b,c) combine [a,b,c]
seq(2,6,by=2) [2,4,6]

```{R}
saveid=paste0("script/plot/",substr(system("git rev-parse HEAD", intern=TRUE),0,7),".png")
saveid

gBuildDim + gQueryDim + gBuildNode + gQueryNode
ggsave(saveid,width=12,dpi=900)
```

Now collect the leave wrapping
```{R}
wrap<-read.csv("script/my_kd_wrap.csv",header=TRUE)
wrap 

wrapQuery<- wrap %>% 
  group_by(wrapSize) %>%
  summarise(avg=mean(queryTime/nodes),.groups="drop") %>%
  select(wrapSize,avg)

wrapBuild<- wrap %>% 
  group_by(wrapSize) %>%
  summarise(avg=mean(buildTime/nodes),.groups="drop") %>%
  select(wrapSize,avg)

# gBuildWrap<-ggplot(wrapBuild, aes(x = wrapSize, y = avg))+
#   geom_point(size=3) +
#   geom_line() + 
#   theme_gray() + 
#   labs(y="Ave build time")

gQueryWrap<-ggplot(wrapQuery, aes(x = wrapSize, y = avg))+
  geom_point(size=3) +
  geom_line() + 
  theme_gray() + 
  labs(y="Ave build time")
saveid=paste0("script/plot/",substr(system("git rev-parse HEAD", intern=TRUE),0,7),"wrap.png")
saveid

gQueryWrap
ggsave(saveid,width=12,dpi=900)
```
